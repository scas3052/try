import{initializeApp as y}from"https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";import{getFirestore as I,doc as u,setDoc as g,getDoc as w}from"https://www.gstatic.com/firebasejs/10.11.1/firebase-firestore.js";import{getAuth as b,createUserWithEmailAndPassword as v,signInWithEmailAndPassword as E,GoogleAuthProvider as U,signInWithPopup as P}from"https://www.gstatic.com/firebasejs/10.11.1/firebase-auth.js";import{getStorage as B}from"https://www.gstatic.com/firebasejs/10.11.1/firebase-storage.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const a of e.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function s(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function o(t){if(t.ep)return;t.ep=!0;const e=s(t);fetch(t.href,e)}})();const L={apiKey:"AIzaSyDqfO7C2jAeFCeggWoDDwnP6Mi0KQF4xCE",authDomain:"haftrail.firebaseapp.com",projectId:"haftrail",storageBucket:"haftrail.firebasestorage.app",messagingSenderId:"308714739048",appId:"1:308714739048:web:ec3732457c4fac96f372dd"},c=y(L),m=I(c),d=b(c);B(c);function r(i,n,s=!1){var o=document.getElementById(n);o.style.display="block",o.innerHTML=i,o.style.opacity=1,o.style.backgroundColor=s?"var(--auth-success)":"var(--auth-error)",setTimeout(function(){o.style.opacity=0},5e3)}const S=document.getElementById("submitSignUp");S.addEventListener("click",i=>{i.preventDefault();const n=document.getElementById("rEmail").value,s=document.getElementById("rPassword").value,o=document.getElementById("fName").value,t=document.getElementById("lName").value,e=document.getElementById("mobileNumber").value;if(!/^\d{10}$/.test(e)){r("Please enter a valid 10-digit mobile number","signUpMessage");return}v(d,n,s).then(a=>{const l=a.user,f={email:n,firstName:o,lastName:t,phone:e};r("Account Created Successfully","signUpMessage",!0);const h=u(m,"users",l.uid);return g(h,f).then(()=>{setTimeout(()=>{sessionStorage.setItem("loggedInUserId",l.uid),window.location.href="homepage.html"},1e3)})}).catch(a=>{const l=a.code;l=="auth/email-already-in-use"?r("Email Address Already Exists","signUpMessage"):r(l==="auth/invalid-email"?"Please enter a valid email address":l==="auth/weak-password"?"Password should be at least 6 characters":"Unable to create account. Please try again.","signUpMessage")})});const M=document.getElementById("submitSignIn");M.addEventListener("click",i=>{i.preventDefault();const n=document.getElementById("email").value,s=document.getElementById("password").value;E(d,n,s).then(o=>{const t=o.user;r("Login successful","signInMessage",!0),setTimeout(()=>{sessionStorage.setItem("loggedInUserId",t.uid),window.location.href="homepage.html"},1e3)}).catch(o=>{const t=o.code;let e;switch(t){case"auth/invalid-email":e="Please enter a valid email address";break;case"auth/user-disabled":e="This account has been disabled";break;case"auth/user-not-found":e="No account exists with this email. Please sign up first.";break;case"auth/wrong-password":e="Incorrect password. Please try again.";break;case"auth/invalid-login-credentials":e="No account exists with this email. Please sign up first.";break;case"auth/invalid-credential":e="Invalid credentials. Please check your email and password.";break;case"auth/missing-password":e="Please enter your password";break;default:e="Login failed. Please try again."}r(e,"signInMessage")})});const N=new U,k=document.getElementById("googleSignIn");k.addEventListener("click",()=>{p("signInMessage")});const A=document.getElementById("googleSignUp");A.addEventListener("click",()=>{p("signUpMessage")});async function p(i){try{const s=(await P(d,N)).user,o=u(m,"users",s.uid);if((await w(o)).exists())r("Login successful",i,!0),setTimeout(()=>{sessionStorage.setItem("loggedInUserId",s.uid),window.location.href="homepage.html"},1e3);else{const e=s.displayName?s.displayName.split(" "):["User",""],a={email:s.email,firstName:e[0],lastName:e.slice(1).join(" "),photoURL:s.photoURL||null};await g(o,a),r("Account Created Successfully",i,!0),sessionStorage.setItem("loggedInUserId",s.uid),sessionStorage.setItem("needsMobileNumber","true"),setTimeout(()=>{window.location.href="profile.html"},1e3)}}catch(n){console.error("Google auth error:",n);let s="Authentication failed. Please try again.";n.code==="auth/popup-closed-by-user"?s="Sign in was cancelled.":n.code==="auth/popup-blocked"&&(s="Pop-up was blocked by your browser. Please allow pop-ups for this site."),r(s,i)}}document.addEventListener("DOMContentLoaded",()=>{const i=sessionStorage.getItem("loggedInUserId"),n=sessionStorage.getItem("adminLoggedIn");if(i){window.location.href="homepage.html";return}else if(n){window.location.href="admin-dashboard.html";return}const s=document.getElementById("signUpButton"),o=document.getElementById("signInButton"),t=document.getElementById("signIn"),e=document.getElementById("signup");s&&s.addEventListener("click",function(a){a.preventDefault(),t.style.display="none",e.style.display="block",e.style.animation="slideUp 0.5s ease-out"}),o&&o.addEventListener("click",function(a){a.preventDefault(),t.style.display="block",e.style.display="none",t.style.animation="slideUp 0.5s ease-out"})});
